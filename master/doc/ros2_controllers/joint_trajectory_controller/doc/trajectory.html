<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trajectory Representation &mdash; ROS2_Control: Rolling May 2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css?v=a5c4661c" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/reviewer_stats.css?v=068b34ac" />

  
    <link rel="shortcut icon" href="../../../../_static/favicon_ros-controls.ico"/>
    <link rel="canonical" href="https://control.ros.org/rolling//rolling/doc/ros2_controllers/joint_trajectory_controller/doc/trajectory.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=dbc0e75d"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../_static/copybutton.js?v=f281be69"></script>
        <script data-domain="control.ros.org" defer="defer" src="https://plausible.io/js/script.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Details about parameters" href="parameters.html" />
    <link rel="prev" title="joint_trajectory_controller" href="userdoc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            
              <img src="../../../../_static/logo_ros-controls.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/doc/index.html">ros2_control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../doc/controllers_index.html">ros2_controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#guidelines-and-best-practices">Guidelines and Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#controllers-for-mobile-robots">Controllers for Mobile Robots</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc/controllers_index.html#controllers-for-manipulators-and-other-robots">Controllers for Manipulators and Other Robots</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../admittance_controller/doc/userdoc.html">Admittance Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../effort_controllers/doc/userdoc.html">Effort Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../forward_command_controller/doc/userdoc.html">Forward Command Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gripper_controllers/doc/userdoc.html">Gripper Controller</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="userdoc.html">Joint Trajectory Controller</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="userdoc.html#hardware-interface-types">Hardware interface types</a></li>
<li class="toctree-l4"><a class="reference internal" href="userdoc.html#other-features">Other features</a></li>
<li class="toctree-l4"><a class="reference internal" href="userdoc.html#using-joint-trajectory-controller-s">Using Joint Trajectory Controller(s)</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="userdoc.html#further-information">Further information</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="#">Trajectory Representation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#interpolation-method-none">Interpolation Method <code class="docutils literal notranslate"><span class="pre">none</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="#interpolation-method-spline">Interpolation Method <code class="docutils literal notranslate"><span class="pre">spline</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="#visualized-examples">Visualized Examples</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="#trajectory-replacement">Trajectory Replacement</a></li>
<li class="toctree-l5"><a class="reference internal" href="parameters.html">joint_trajectory_controller Parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../rqt_joint_trajectory_controller/doc/userdoc.html">rqt_joint_trajectory_controller</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../pid_controller/doc/userdoc.html">PID Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../position_controllers/doc/userdoc.html">Position Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../velocity_controllers/doc/userdoc.html">Velocity Controllers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#broadcasters">Broadcasters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#common-controller-parameters">Common Controller Parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control_demos/doc/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/ros2controlcli/doc/userdoc.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simulators/simulators.html">Simulator Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes/release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../migration/migration.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_list/api_list.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../supported_robots/supported_robots.html">Supported Robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_ideas.html">Project Ideas for GSoC 2024</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements/acknowledgements.html">Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ROS2_Control: Rolling</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../doc/controllers_index.html">ros2_controllers</a></li>
          <li class="breadcrumb-item"><a href="userdoc.html">joint_trajectory_controller</a></li>
      <li class="breadcrumb-item active">Trajectory Representation</li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/ros-controls/ros2_controllers/blob/master/joint_trajectory_controller/doc/trajectory.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             

<p>
  <strong>
    
    You're reading the documentation for a development version.
    For the latest released version, please have a look at <a href="../../../../../iron/doc/ros2_controllers/joint_trajectory_controller/doc/trajectory.html">Iron</a>.
    
  </strong>
</p>


  <section id="trajectory-representation">
<span id="joint-trajectory-controller-trajectory-representation"></span><h1>Trajectory Representation<a class="headerlink" href="#trajectory-representation" title="Link to this heading"></a></h1>
<p>Trajectories are represented internally with <code class="docutils literal notranslate"><span class="pre">trajectory_msgs/msg/JointTrajectory</span></code> data structure.</p>
<p>Currently, two interpolation methods are implemented: <code class="docutils literal notranslate"><span class="pre">none</span></code> and <code class="docutils literal notranslate"><span class="pre">spline</span></code>.
By default, a spline interpolator is provided, but it’s possible to support other representations.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The user has to ensure that the correct inputs are provided for the trajectory, which are needed
by the controller’s setup of command interfaces and PID configuration. There is no sanity check and
missing fields in the sampled trajectory might cause segmentation faults.</p>
</div>
<section id="interpolation-method-none">
<h2>Interpolation Method <code class="docutils literal notranslate"><span class="pre">none</span></code><a class="headerlink" href="#interpolation-method-none" title="Link to this heading"></a></h2>
<p>It returns the initial point until the time for the first trajectory data point is reached. Then, it simply takes the next given datapoint.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It does not deduce (integrate) trajectory from derivatives, nor does it calculate derivatives.
I.e., one has to provide position and its derivatives as needed.</p>
</div>
</section>
<section id="interpolation-method-spline">
<h2>Interpolation Method <code class="docutils literal notranslate"><span class="pre">spline</span></code><a class="headerlink" href="#interpolation-method-spline" title="Link to this heading"></a></h2>
<p>The spline interpolator uses the following interpolation strategies depending on the waypoint specification:</p>
<ul class="simple">
<li><p>Linear:</p>
<ul>
<li><p>Used, if only position is specified.</p></li>
<li><p>Returns position and velocity</p></li>
<li><p>Guarantees continuity at the position level.</p></li>
<li><p>Discouraged because it yields trajectories with discontinuous velocities at the waypoints.</p></li>
</ul>
</li>
<li><p>Cubic:</p>
<ul>
<li><p>Used, if position and velocity are specified.</p></li>
<li><p>Returns position, velocity, and acceleration.</p></li>
<li><p>Guarantees continuity at the velocity level.</p></li>
</ul>
</li>
<li><p>Quintic:</p>
<ul>
<li><p>Used, if position, velocity and acceleration are specified</p></li>
<li><p>Returns position, velocity, and acceleration.</p></li>
<li><p>Guarantees continuity at the acceleration level.</p></li>
</ul>
</li>
</ul>
<p>Trajectories with velocity fields only, velocity and acceleration only, or acceleration fields only can be processed and are accepted, if <code class="docutils literal notranslate"><span class="pre">allow_integration_in_goal_trajectories</span></code> is true. Position (and velocity) is then integrated from velocity (or acceleration, respectively) by Heun’s method.</p>
</section>
<section id="visualized-examples">
<h2>Visualized Examples<a class="headerlink" href="#visualized-examples" title="Link to this heading"></a></h2>
<p>To visualize the difference of the different interpolation methods and their inputs, different trajectories defined at a 0.5s grid and are sampled at a rate of 10ms.</p>
<ul class="simple">
<li><p>Sampled trajectory with linear spline if position is given only:</p></li>
</ul>
<img alt="Sampled trajectory with splines if position is given only" src="../../../../_images/spline_position.png" />
<ul class="simple">
<li><p>Sampled trajectory with cubic splines if velocity is given only (no deduction for interpolation method <code class="docutils literal notranslate"><span class="pre">none</span></code>):</p></li>
</ul>
<img alt="Sampled trajectory with splines if velocity is given only" src="../../../../_images/spline_velocity.png" />
<ul class="simple">
<li><p>Sampled trajectory if position and velocity is given:</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the same integration method was used (<code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> class uses Heun’s method), then the <code class="docutils literal notranslate"><span class="pre">spline</span></code> method this gives identical results as above where velocity only was given as input.</p>
</div>
<img alt="Sampled trajectory if position and velocity is given" src="../../../../_images/spline_position_velocity.png" />
<ul class="simple">
<li><p>Sampled trajectory with quintic splines if acceleration is given only (no deduction for interpolation method <code class="docutils literal notranslate"><span class="pre">none</span></code>):</p></li>
</ul>
<img alt="Sampled trajectory with splines if acceleration is given only" src="../../../../_images/spline_acceleration.png" />
<ul class="simple">
<li><p>Sampled trajectory if position, velocity, and acceleration points are given:</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the same integration method was used (<code class="docutils literal notranslate"><span class="pre">Trajectory</span></code> class uses Heun’s method), then the <code class="docutils literal notranslate"><span class="pre">spline</span></code> method this gives identical results as above where acceleration only was given as input.</p>
</div>
<img alt="Sampled trajectory with splines if position, velocity, and acceleration is given" src="../../../../_images/spline_position_velocity_acceleration.png" />
<ul class="simple">
<li><p>Sampled trajectory if the same position, velocity, and acceleration points as above are given, but with a nonzero initial point:</p></li>
</ul>
<img alt="Sampled trajectory with splines if position, velocity, and acceleration is given with nonzero initial point" src="../../../../_images/spline_position_velocity_acceleration_initialpoint.png" />
<ul class="simple">
<li><p>Sampled trajectory if the same position, velocity, and acceleration points as above are given but with the first point starting at <code class="docutils literal notranslate"><span class="pre">t=0</span></code>:</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the first point is starting at <code class="docutils literal notranslate"><span class="pre">t=0</span></code>, there is no interpolation from the initial point to the trajectory.</p>
</div>
<img alt="Sampled trajectory with splines if position, velocity, and acceleration is given with nonzero initial point and first point starting at ``t=0``" src="../../../../_images/spline_position_velocity_acceleration_initialpoint_notime.png" />
<ul class="simple">
<li><p>Sampled trajectory with splines if inconsistent position, velocity, and acceleration points are given:</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Interpolation method <code class="docutils literal notranslate"><span class="pre">none</span></code> only gives the next input points, while the <code class="docutils literal notranslate"><span class="pre">spline</span></code> interpolation method shows high overshoot to match the given trajectory points.</p>
</div>
<img alt="Sampled trajectory with splines if inconsistent position, velocity, and acceleration is given" src="../../../../_images/spline_wrong_points.png" />
</section>
</section>
<section id="trajectory-replacement">
<span id="joint-trajectory-controller-trajectory-replacement"></span><h1>Trajectory Replacement<a class="headerlink" href="#trajectory-replacement" title="Link to this heading"></a></h1>
<p><em>Parts of this documentation were originally published in the ROS 1 wiki under the</em> <a class="reference external" href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0 license</a>. <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p>
<p>Joint trajectory messages allow to specify the time at which a new trajectory should start executing by means of the header timestamp, where zero time (the default) means “start now”.</p>
<p>The arrival of a new trajectory command does not necessarily mean that the controller will completely discard the currently running trajectory and substitute it with the new one.
Rather, the controller will take the useful parts of both and combine them appropriately, yielding a smarter trajectory replacement strategy.</p>
<p>The steps followed by the controller for trajectory replacement are as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Get useful parts of the new trajectory: Preserve all waypoints whose time to be reached is in the future, and discard those with times in the past.
If there are no useful parts (ie. all waypoints are in the past) the new trajectory is rejected and the current one continues execution without changes.</p></li>
<li><p>Get useful parts of the current trajectory: Preserve the current trajectory up to the start time of the new trajectory, discard the later parts.</p></li>
<li><p>Combine the useful parts of the current and new trajectories.</p></li>
</ul>
</div></blockquote>
<p>The following examples describe this behavior in detail.</p>
<p>The first example shows a joint which is in hold position mode (flat grey line labeled <em>pos hold</em> in the figure below).
A new trajectory (shown in red) arrives at the current time (now), which contains three waypoints and a start time in the future (<em>traj start</em>).
The time at which waypoints should be reached (<code class="docutils literal notranslate"><span class="pre">time_from_start</span></code> member of <code class="docutils literal notranslate"><span class="pre">trajectory_msgs/JointTrajectoryPoint</span></code>) is relative to the trajectory start time.</p>
<p>The controller splices the current hold trajectory at time <em>traj start</em> and appends the three waypoints.
Notice that between now and <em>traj start</em> the previous position hold is still maintained, as the new trajectory is not supposed to start yet.
After the last waypoint is reached, its position is held until new commands arrive.</p>
<img alt="Receiving a new trajectory." src="../../../../_images/new_trajectory.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The controller guarantees that the transition between the current and new trajectories will be smooth. Longer times to reach the first waypoint mean slower transitions.</p>
<p>The next examples discuss the effect of sending the same trajectory to the controller with different start times.
The scenario is that of a controller executing the trajectory from the previous example (shown in red),
and receiving a new command (shown in green) with a trajectory start time set to either zero (start now),
a future time, or a time in the past.</p>
<img alt="Trajectory start time in the future." src="../../../../_images/trajectory_replacement_future.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="Zero trajectory start time (start now)." src="../../../../_images/trajectory_replacement_now.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Of special interest is the last example, where the new trajectory start time and first waypoint are in the past (before now).
In this case, the first waypoint is discarded and only the second one is realized.</p>
<img alt="Trajectory start time in the past." src="../../../../_images/trajectory_replacement_past.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Adolfo Rodriguez: <a class="reference external" href="http://wiki.ros.org/joint_trajectory_controller/UnderstandingTrajectoryReplacement">Understanding trajectory replacement</a></p>
</aside>
</aside>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="userdoc.html" class="btn btn-neutral float-left" title="joint_trajectory_controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="parameters.html" class="btn btn-neutral float-right" title="Details about parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, ros2_control Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: master
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Releases</dt>
        <dd><a href="../../../../../iron/doc/ros2_controllers/joint_trajectory_controller/doc/trajectory.html">Iron (latest)</a></dd><br>
        <dd><a href="../../../../../humble/doc/ros2_controllers/joint_trajectory_controller/doc/trajectory.html">Humble</a></dd><br>
        <dd><a href="../../../../../galactic/index.html">Galactic (EOL)</a></dd><br>
        
        <dd><a href="../../../../../foxy/index.html">Foxy (EOL)</a></dd><br>
        
    </dl>
    <dl>
      <dt>In Development</dt>
      <dd><a href="trajectory.html">Master</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>